emergency report action patient base action  patient dao patient dao allergy dao allergy dao office visit dao ov dao patient bean pb email util emailutil emergency report action dao factory factory logged in mid string pid string i trust exception  super factory pid string this patient dao  factory get patient dao this allergy dao  factory get allergy dao this ov dao  factory get office visit dao emailutil  email util factory pb  patient dao get patient this pid emailutil send email make email  string get patient name  pb get first name     pb get last name  string get patient age  integer to string pb get age  string get patient gender  pb get gender to string  string get patient emergency contact  pb get emergency name     pb get emergency phone  string get blood type  pb get blood type    list allergy bean get allergies i trust exception  allergy dao get allergies this pid  list prescription bean get current prescriptions i trust exception  list prescription bean all prescriptions  patient dao get current prescriptions this pid array list prescription bean warning list  array list prescription bean int i  0 i  all prescriptions size i  prescription alerts is alert all prescriptions get i get medication get nd code warning list add all prescriptions get i  warning list  list diagnosis bean get warning diagnoses i trust exception   dup  false list diagnosis bean all diagnoses  patient dao get diagnoses this pid array list diagnosis bean warning list  array list diagnosis bean diagnosis bean bean all diagnoses  office visit bean ovb  ov dao get office visit bean get visit id if ovb  null continue  yes equals bean get classification  ovb get visit date get time  calendar get instance get time in millis  30  24  60  60  1000  diagnosis bean wbean warning list  bean get description equals wbean get description  dup  true   dup  warning list add bean    warning list  db exception dbe  i trust exception dbe get message   list procedure bean get immunizations i trust exception  list procedure bean all immunizations  patient dao get immunization procedures this pid all immunizations  email make email db exception email email  email list patient bean reps  patient dao get representing pb get mid list string to addrs  array list string to addrs add pb get email patient bean r reps  to addrs add r get email  email set from no reply itrust com email set to list to addrs email set subject string format emergency report viewed notification email set body dear   pb get full name  n an emergency report has been generated   please login to i trust to see who has viewed your records email  